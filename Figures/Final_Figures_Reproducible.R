library(dplyr)
library(ggplot2)
library(reshape)
library(ggforce)

####Reading in Data####
#Reading in the time data
data.time <- rbind(read.csv("./Cluster_data/annulus.csv", header = TRUE),
                   read.csv("./Cluster_data/circle.csv", header = TRUE),
                   read.csv("./Cluster_data/torus.csv", header = TRUE),
                   read.csv("./Cluster_data/uniform.csv", header = TRUE))
#Adding Column Names
colnames(data.time) <- c("row", "measure.type", "point.cloud", "point.cloud.dim", 
                         "num.points", "feat.dim", "library", 
                         "time1", "time2", "time3", "time4", 
                         "time5", "time6", "time7",
                         "time8", "time9", "time10")

#Remove extraneaous row variable
data.time <- data.time %>% select(-"row")

#Creating average and standard deviation columns for time data
data.time$avg.time <- apply(data.time[,7:16],1,mean)
data.time$std <- apply(data.time[,7:16],1,sd)
data.time$min.time <- apply(data.time[,7:16],1,min)
data.time$max.time <- apply(data.time[,7:16],1,max)

#Create Factor labels for libraries
data.time$library <- factor(data.time$library,
                            levels = c("stats","Dionysus","GUDHI", "GUDHIalpha"),
                            labels = c("TDAstats", "Dionysus", "GUDHI Rips", "GUDHI Alpha"))

#Read in object size data
data.mem <- read.csv("./mem1.csv", header = FALSE)

#Name columns
colnames(data.mem) <- c("measure.type", "point.cloud", "point.cloud.dim", 
                        "num.points", "feat.dim", "library", "memory")

#Create Factor labels for libraries
data.mem$library <- factor(data.mem$library,
                           levels = c("stats","Dionysus","GUDHI", "GUDHIalpha"),
                           labels = c("TDAstats", "Dionysus", "GUDHI Rips", "GUDHI Alpha"))


####Figure_1####
#Goal: overview showing speed differences across engines on a canonical shape.

#Selected torus data scanning for two dimensional features
data.fig.1 <- subset(data.time, point.cloud == "torus" & feat.dim == 2 & 
                       library != "GUDHI Alpha") 

#Point graph; X: Num.points; Y: Runtime; Color: TDA library
fig.1 <- ggplot(data.fig.1, aes(x=num.points, y=avg.time, color=library)) + 
  geom_point()+
  geom_errorbar(data.fig.1, mapping = aes(x=num.points, 
                                          ymin=avg.time - std, 
                                          ymax=avg.time + std)) +
  labs(color = "TDA Library",
       x = "Number of Points on Torus",
       y = "Average Run Time",
       title = "Rips Complex Run Times on 3D Torus Point Clouds",
       subtitle = "") 

#Editing the colors (Making everything blank)
fig.1 <- fig.1 + theme_classic() +
  theme(legend.position = c(0.85, 0.5),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 7),
        plot.title = element_text(hjust = 0.5),
        axis.line = element_line(colour = "black"),
        legend.text.align = 0,
        legend.title.align = 0)

#Saving plot as png for later editing
ggsave("./Figures/Unrasterized_Images/fig1.png", plot = fig.1,
       scale = 1, width = 6, height = 4, units = "in",
       dpi = 400, limitsize = TRUE)



####Figure_2####
#Goal Comparison of persistent homology calculation runtimes 
#across R packages for n-dimensional sphere (n = 2, 3, 4)

#Selected all boxes up to n-1 dimensional features
data.fig.2 <- subset(data.time, point.cloud == "circle" & library != "GUDHI Alpha")
data.fig.2 <- data.fig.2[(data.fig.2$point.cloud.dim - 1 == data.fig.2$feat.dim), ]

#Point graph facet; X: Num.points; Y: Runtime; Color: TDA library; Facet: Dimensions of Sphere
fig.2 <- ggplot(data.fig.2, aes(x=num.points, y=avg.time, color=library)) + 
  geom_point() +
  facet_wrap( ~ point.cloud.dim, ncol=3, scales = "free") + 
  geom_errorbar(data.fig.2, mapping = aes(x=num.points, 
                                          ymin=avg.time - std, 
                                          ymax=avg.time + std)) +
  labs(color = "TDA Library",
       x = "Number of Points on N-Sphere",
       y = "Average Run Time",
       title = "Rips Complex Run Times For n-Dimensional Spheres",
       subtitle = "") +
  scale_x_continuous(limits=c(0,550), breaks = c(100, 200, 300, 400, 500)) + 
  scale_y_continuous(limits=c(-30,2100))


#Editing the colors (Making everything blank)
fig.2 <- fig.2 + theme_classic() +
  theme(legend.position = c(0.93, 0.50),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 7),
        plot.title = element_text(hjust = 0.5),
        legend.text.align = 0,
        legend.title.align = 0,
        strip.background = element_blank(),
        strip.text.x = element_blank(),
        axis.line=element_line(),
        axis.text.x = element_text(angle=-45, hjust=.025))

#Saving plot as png for later editing
ggsave("./Figures/Unrasterized_Images/fig2.png", plot = fig.2,
       scale = 1, width = 12, height = 4, units = "in",
       dpi = 400, limitsize = TRUE)


####Figure 3: Runtime of persistent homology calculation as a function of feature dimension####
#Select all annulus data for all dimension point cloud and n-1 dim features
data.fig.3 <- subset(data.time, point.cloud == "uniform" & 
                       point.cloud.dim == 8 & library != "GUDHI Alpha" & 
                       (num.points == 10 | num.points == 15| num.points == 20))
data.fig.3$num.points <- as.factor(data.fig.3$num.points)

#Point graph facet; X: Num.points; Y: Runtime; Color: TDA library; Facet: Dimensions of Annulus
fig.3 <- ggplot(data.fig.3, aes(x=feat.dim, y=avg.time, color=num.points)) + 
  geom_point() + facet_wrap(~library, scales = "free") + 
  geom_errorbar(data.fig.3, mapping = aes(x=feat.dim, 
                                          ymin=avg.time - std, 
                                          ymax=avg.time + std)) +
  labs(color = "Number of \nPoints",
       x = "Feature Dimensions",
       y = "Average Run Time",
       title = "Run Times For Extracting Dimensional \nFeatures on an 8 Dimensional Box",
       subtitle = "") + scale_x_continuous(limits=c(0, 8), breaks=seq(0,8,1)) +
  scale_y_continuous(limits=c(0, 3))

#Editing the colors (Making everything blank)
fig.3 <- fig.3 + theme_classic() +
  theme(legend.position = c(0.93, 0.60),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 7),
        plot.title = element_text(hjust = 0.5),
        legend.text.align = 0,
        legend.title.align = 0,
        strip.background = element_blank(),
        #strip.text.x = element_blank(),
        axis.text.x = element_text(angle=0, hjust=.025))

#Saving plot as png for later editing
ggsave("./Figures/Unrasterized_Images/fig3.png", plot = fig.3,
       scale = 1, width = 12, height = 4, units = "in",
       dpi = 400, limitsize = TRUE)


####Figure 4: Runtime of persistent homology calculation as a function of point cloud####
#Goal: show how increasing dimension slows down the calculation time.

#Select all 3D annuluses and change feature dimension to a factor variable
data.fig.4 <- subset(data.time, point.cloud == "annulus" & feat.dim == 1 & 
                       (library == "GUDHI Rips" | library == "GUDHI Alpha"))
data.fig.4$point.cloud.dim <- as.factor(data.fig.4$point.cloud.dim)
data.fig.4 <- as.data.frame(data.fig.4)

#Point graph facet; X: Num.points; Y: Runtime; Color: point.cloud dim; Facet: library
fig.4 <- ggplot(data.fig.4, aes(x=num.points, y=avg.time, color=point.cloud.dim)) + 
  geom_point() + facet_wrap(~library, scales = "free") + 
  geom_errorbar(data.fig.4, mapping = aes(x=num.points, 
                                          ymin=avg.time - std, 
                                          ymax=avg.time + std)) +
  labs(color = "Annulus \nDimension",
       x = "Number of Points",
       y = "Average Run Time",
       title = "Rips vs Alpha Complex Run Times For Extracting \n1 Dimensional Features on N-dimensional Annuluses",
       subtitle = "") + 
  scale_x_continuous(limits=c(0,550), breaks = c(100, 200, 300, 400, 500)) + 
  scale_y_continuous(limits=c(-.02, 22))

#Editing the colors (Making everything blank)
fig.4 <- fig.4 + theme_classic() +
  theme(legend.position = c(0.95, 0.50),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 7),
        plot.title = element_text(hjust = 0.5),
        legend.text.align = 0,
        legend.title.align = 0,
        axis.text.x = element_text(angle=0, hjust=.025),
        strip.background = element_blank(),
        strip.text.x = element_text())

#Saving plot as png for later editing
ggsave("./Figures/Unrasterized_Images/fig4.png", plot = fig.4,
       scale = 1, width = 8, height = 4, units = "in",
       dpi = 400, limitsize = TRUE)

####Figure 5: Object Size use of Rips complex vs alpha complex. Engine = GUDHI(alpha).#### 
#Goal: compare memory
data.fig.5a <- subset(data.mem, point.cloud.dim == 3 & feat.dim == 2)

#Point graph facet; X: Num.points; Y: Memory; Color: Library; Facet: Pointcloud
fig.5a <- ggplot(data.fig.5a, aes(x=num.points, y=memory, color=library)) + 
  geom_point() + facet_wrap(~point.cloud, scales = "free") + 
  labs(color = "Complex",
       x = "Number of Points",
       y = "Object Size",
       title = "Object Size of Boundary Matrix",
       subtitle = "")+ 
  scale_x_continuous(limits=c(50,550), breaks = c(100, 200, 300, 400, 500)) + 
  scale_y_continuous(limits=c(0, 1.8e10), breaks = c(1e5, 5e9, 1e10, 1.5e10)) 

#Editing the colors (Making everything blank)
fig.5a <- fig.5a + theme_classic() +
  theme(legend.position = c(.915, 0.915),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 7),
        plot.title = element_text(hjust = 0.5),
        legend.text.align = 0,
        legend.title.align = 0.8,
        axis.text.x = element_text(angle=0, hjust=.025),
        strip.background = element_blank(),
        #plot.margin = unit(c(1,3,1,1), "cm"),
        strip.text.x = element_blank())

#Saving plot as png for later editing
ggsave("./Figures/Unrasterized_Images/fig5a.png", plot = fig.5a,
       scale = 1, width = 6, height = 4, units = "in",
       dpi = 400, limitsize = TRUE)

#Show what Rips Object Size depends on
data.fig.5b <- subset(data.mem, library == "GUDHI Rips")
data.fig.5b$feat.dim <- as.factor(data.fig.5b$feat.dim)

#Point graph facet; X: Num.points; Y: Memory; Color: Feat.Dim; 
fig.5b <- ggplot(data.fig.5b, aes(x=num.points, y=memory, color=feat.dim)) + 
  geom_point() + 
  labs(color = "Feature \n Dimension",
       x = "Number of Points",
       y = "Object Size",
       title = "Object Size of Rips Complex Boundary Matrix",
       subtitle = "")+ 
  scale_x_continuous(limits=c(50,550), breaks = c(100, 200, 300, 400, 500)) + 
  scale_y_continuous(limits=c(0, 1.8e10), 
                     labels = function(x) format(x, scientific = TRUE))

#Editing the colors (Making everything blank)
fig.5b <- fig.5b + theme_classic() +
  theme(legend.position = c(0.92, 0.550),
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 7),
        plot.title = element_text(hjust = 0.5),
        legend.text.align = 0,
        legend.title.align = 0,
        axis.text.x = element_text(angle=0, hjust=.025),
        strip.background = element_blank(),
        #plot.margin = unit(c(1,3,1,1), "cm"),
        strip.text.x = element_blank())

#Saving plot as png for later editing
ggsave("./Figures/Unrasterized_Images/fig5b.png", plot = fig.5b,
       scale = 1, width = 8, height = 6, units = "in",
       dpi = 400, limitsize = TRUE)

#Show what Alpha Complex Object Size depends on
data.fig.5c <- subset(data.mem, library == "GUDHI Alpha")
#This is necessary since Alpha Complex Object Size Function Did Not
#Calculate Feat Dimensions lower than Point Cloud Dim - 1 in all cases
#This subset is necessary to remove the extraneous conditions that
#were not passed on to the alpha complex object size
data.fig.5c <- subset(data.fig.5c, point.cloud.dim - feat.dim == 1)

data.fig.5c$feat.dim <- as.factor(data.fig.5c$feat.dim)


#Point graph facet; X: Num.points; Y: Memory; Color: Feat.Dim; 
fig.5c <- ggplot(data.fig.5c, aes(x=num.points, y=memory, color=feat.dim)) + 
  geom_point() + facet_wrap(~point.cloud, scales = "free") +
  labs(color = "Feature \n Dimension",
       x = "Number of Points",
       y = "Object Size",
       title = "Object Size of Alpha Complex Boundary Matrix",
       subtitle = "")+ 
  scale_x_continuous(limits=c(50,550), breaks = c(100, 200, 300, 400, 500)) + 
  scale_y_continuous(limits=c(0, 1.24e6), 
                     labels = function(x) format(x, scientific = TRUE))

#Editing the colors (Making everything blank)
fig.5c <- fig.5c + theme_classic() + theme(
  legend.position = c(.915, 0.915),
  legend.title = element_text(size = 9),
  legend.text = element_text(size = 7),
  plot.title = element_text(hjust = 0.5),
  legend.text.align = 0,
  legend.title.align = 0,
  #plot.title = element_text(hjust = 0.5),
  axis.text.x = element_text(angle=0, hjust=.025),
  strip.background = element_blank(),
  strip.text.x = element_blank(), 
  #plot.margin = unit(c(1,3,1,1), "cm"),
  panel.spacing = unit(2, "lines"))

#Saving plot as png for later editing
ggsave("./Figures/Unrasterized_Images/fig5c.png", plot = fig.5c,
       scale = 1, width = 8, height = 6, units = "in",
       dpi = 400, limitsize = TRUE)


#####Figure 6 (for discussion) TDAstats vs GUDHIalpha for runtime.####
data.fig.6 <- subset(data.time, point.cloud.dim == 3 & feat.dim == 2 & 
                       (library == "TDAstats" | library == "GUDHI Alpha"))

#Point graph facet; X: Num.points; Y: time; Color: Library; Facet: Pointcloud
fig.6 <- ggplot(data.fig.6, aes(x=num.points, y=avg.time, color=library)) + 
  facet_wrap(~point.cloud, scales = "free") + 
  geom_errorbar(data.fig.6, mapping = aes(x=num.points, 
                                          ymin=avg.time - std, 
                                          ymax=avg.time + std)) + geom_point() +
  labs(color = "Library",
       x = "Number of Points",
       y = "Average Run Time (s)",
       title = "Rips (TDAstats) vs Alpha Complex (GUDHI) \nRun Times on 3D Point Clouds",
       subtitle = "") + 
  scale_x_continuous(limits=c(5,550), breaks = c(100, 200, 300, 400, 500)) + 
  scale_y_continuous(limits=c(-.05, 84))

#Editing the colors (Making everything blank)
fig.6 <- fig.6 + theme_classic()
fig.6 <- fig.6 + theme(
  legend.position = c(.915, 1.12),
  legend.title = element_text(size = 9),
  legend.text = element_text(size = 7),
  plot.title = element_text(hjust = 0.5),
  legend.text.align = 0,
  legend.title.align = 0.9,
  #plot.title = element_text(hjust = 0.5),
  axis.text.x = element_text(angle=0, hjust=.025),
  strip.background = element_blank(),
  strip.text.x = element_blank())
#plot.margin = unit(c(1,3,1,1), "cm"),
#panel.spacing = unit(2, "lines"))

#Saving plot as png for later editing
ggsave("./Figures/Unrasterized_Images/fig6.png", plot = fig.6,
       scale = 1, width = 6, height = 4, units = "in",
       dpi = 400, limitsize = TRUE)


####Intro Figures####
####Rips Complex
library("ggtda")

n <- 5;
set.seed(3)
d <- data.frame(
  x = runif(n, 0, .8),
  y = runif(n, 0, .8)
)
# compute the persistent homology
ph <- as.data.frame(TDAstats::calculate_homology(as.matrix(d), dim = 1))
print(head(ph, n = 12))
ph <- transform(ph, dim = as.factor(dimension))

prox <- .25
p_d1 <- ggplot(d, aes(x = x, y = y)) +
  theme_classic() +
  coord_fixed() +
  stat_disk(radius = prox/2, fill = "aquamarine3") +
  geom_point() +theme(axis.title = element_blank(),
                      axis.text = element_blank(),
                      axis.ticks = element_blank(),
                      axis.line=element_blank())
p_sc1 <- ggplot(d, aes(x = x, y = y)) +
  theme_classic() +
  coord_fixed() +
  stat_vietoris2(diameter = prox, fill = "darkgoldenrod") +
  stat_vietoris1(diameter = prox, alpha = .25) +
  stat_vietoris0() + theme(axis.title = element_blank(),
                           axis.text = element_blank(),
                           axis.ticks = element_blank(),
                           axis.line=element_blank())

prox <- .5
p_d2 <- ggplot(d, aes(x = x, y = y)) +
  theme_classic() +
  coord_fixed() +
  stat_disk(radius = prox/2, fill = "aquamarine3") +
  geom_point() +theme(axis.title = element_blank(),
                      axis.text = element_blank(),
                      axis.ticks = element_blank(),
                      axis.line=element_blank())
p_sc2 <- ggplot(d, aes(x = x, y = y)) +
  theme_classic() +
  coord_fixed() +
  stat_vietoris2(diameter = prox, fill = "darkgoldenrod") +
  stat_vietoris1(diameter = prox, alpha = .25) +
  stat_vietoris0() + theme(axis.title = element_blank(),
                           axis.text = element_blank(),
                           axis.ticks = element_blank(),
                           axis.line=element_blank())

prox <- .75
p_d3 <- ggplot(d, aes(x = x, y = y)) +
  theme_classic() +
  coord_fixed() +
  stat_disk(radius = prox/2, fill = "aquamarine3") +
  geom_point() +theme(axis.title = element_blank(),
                      axis.text = element_blank(),
                      axis.ticks = element_blank(),
                      axis.line=element_blank())
p_sc3 <- ggplot(d, aes(x = x, y = y)) +
  theme_classic() +
  coord_fixed() +
  stat_vietoris2(diameter = prox, fill = "darkgoldenrod") +
  stat_vietoris1(diameter = prox, alpha = .25) +
  stat_vietoris0() + theme(axis.title = element_blank(),
                           axis.text = element_blank(),
                           axis.ticks = element_blank(),
                           axis.line=element_blank())

# combine and save the plots
png(filename = "./Figures/Final_Figures/Intro_Rips.png",
    width = 6, height = 4, units = "in", res = 450)

gridExtra::grid.arrange(
  p_d1, 
  p_d2,
  p_d2,
  p_sc1, 
  p_sc2,
  p_sc3,
  nrow = 2)

dev.off()

####Alpha Complex
library(deldir)
library(ggplot2)

df <- d

#This creates the voronoi line segments
voronoi <- deldir(d$x, d$y)
voronoi$delsgs %>% mutate(
  distance = sqrt((x1-x2)^2+(y1-y2)^2),
)  -> voronoi$delsgs


#Now we can make a plot
alp.1 <- ggplot(data=df, aes(x=x,y=y)) +
  #Plot the union balls
  geom_circle(data= df, aes(x0=x,y0=y, r = .25/2), fill = "aquamarine", alpha = 1.0, inherit.aes = FALSE, color = NA) + 
  coord_fixed() + theme_classic() + theme(axis.title = element_blank(),
                                          axis.text = element_blank(),
                                          axis.ticks = element_blank(),
                                          axis.line=element_blank()) +
  #Plot the voronoi lines
  geom_segment(
    aes(x = x1, y = y1, xend = x2, yend = y2),
    size = .5,
    data = voronoi$dirsgs,
    linetype = 1,
    color= "#FFB958") + 
  #Plot the simplicies
  geom_segment(
    aes(x = x1, y = y1, xend = x2, yend = y2),
    size = 1,
    data = subset(voronoi$delsgs, distance <= .25),
    linetype = 1,
    color= "black") +
  #Plot the points
  geom_point(
    fill=rgb(70,130,180,255,maxColorValue=255),
    pch=21,
    size = 2,
    color="#333333") 

alp.2 <- ggplot(data=df, aes(x=x,y=y)) +
  #Plot the union balls
  geom_circle(data= df, aes(x0=x,y0=y, r = .35/2), fill = "aquamarine", alpha = 1.0, inherit.aes = FALSE, color = NA) + 
  coord_fixed() + theme_classic() + theme(axis.title = element_blank(),
                                          axis.text = element_blank(),
                                          axis.ticks = element_blank(),
                                          axis.line=element_blank()) +
  #Plot the voronoi lines
  geom_segment(
    aes(x = x1, y = y1, xend = x2, yend = y2),
    size = .5,
    data = voronoi$dirsgs,
    linetype = 1,
    color= "#FFB958") + 
  #Plot the simplices
  geom_segment(
    aes(x = x1, y = y1, xend = x2, yend = y2),
    size = 1,
    data = subset(voronoi$delsgs, distance <= .35),
    linetype = 1,
    color= "black") +
  #Plot the points
  geom_point(
    fill=rgb(70,130,180,255,maxColorValue=255),
    pch=21,
    size = 2,
    color="#333333") 



alp.3 <- ggplot(data=df, aes(x=x,y=y)) +
  #Plot union balls
  geom_circle(data= df, aes(x0=x,y0=y, r = .45/2), fill = "aquamarine", alpha = 1.0, inherit.aes = FALSE, color = NA) + 
  coord_fixed() + theme_classic() + theme(axis.title = element_blank(),
                                          axis.text = element_blank(),
                                          axis.ticks = element_blank(),
                                          axis.line=element_blank()) +
  #Plot the voronoi lines
  geom_segment(
    aes(x = x1, y = y1, xend = x2, yend = y2),
    size = .5,
    data = voronoi$dirsgs,
    linetype = 1,
    color= "#FFB958") + 
  #Plot the simplices
  geom_segment(
    aes(x = x1, y = y1, xend = x2, yend = y2),
    size = 1,
    data = subset(voronoi$delsgs, distance <= .45),
    linetype = 1,
    color= "black")  + 
  #Plot the points
  geom_point(
    fill=rgb(70,130,180,255,maxColorValue=255),
    pch=21,
    size = 2,
    color="#333333")


# combine and save the plots
png(filename = "./Figures/Final_Figures/Intro_Alpha.png",
    width = 6, height = 3, units = "in", res = 450)

gridExtra::grid.arrange(
  alp.1, 
  alp.2,
  alp.3,
  nrow = 1)

dev.off()




library(scatterplot3d)
library(recexcavAAR)
library(readr)
library(TDA)
library(TDAstats)

####Creating Point Clouds For Figure Visual Aid####
#At this point, all results are calculated
#Subsequent Code is just to add visual point cloud imagery to ggfigures

#Call point cloud functions for visualization
source("Functions.R")

#Create circle, zero the y so that the circle is looking normal
circle.2d <- unifcircle(200, 2)
circle.2d <- cbind(circle.2d, 0)
circle.2d <- circle.2d[,c(1,3,2)]

#Save Plot As Image
png(filename = "./Figures/Unrasterized_Images/circle.png",
    width = 1.36*5, height = 1*5, units = "in", res = 300)

scatterplot3d(circle.2d, pch = 20, 
              grid=F, box=F,
              axis = F, angle = 0, highlight.3d = T)
dev.off()


#Create sphere
circle.3d <- unifcircle(900, 3)

#Save Plot As Image
png(filename = "./Figures/Unrasterized_Images/sphere.png",
    width = 1.16*5, height = 1*5, units = "in", res = 300)

scatterplot3d(circle.3d, pch = 20, 
              grid=F, box=F,
              axis = F, angle = 5, highlight.3d = T)

dev.off()


#Create Annulus, zero the y so that the circle is looking normal
annulus.2d <- noisycircle(400, 2)
annulus.2d <- cbind(annulus.2d, 0)
annulus.2d <- annulus.2d[,c(1,3,2)]

#Save Plot As Image
png(filename = "./Figures/Unrasterized_Images/2annulus.png",
    width = 1.26*5, height = 1*5, units = "in", res = 300)

scatterplot3d(annulus.2d, pch = 20, 
              highlight.3d = T,  
              grid=F, box=F,
              axis = F, angle = 0)
dev.off()


#Create 3d annulus
annulus.3d <- noisycircle(1300, 3)

#Save Plot As Image
png(filename = "./Figures/Unrasterized_Images/3annulus.png",
    width = 1.16*5, height = 1*5, units = "in", res = 300)

scatterplot3d(annulus.3d, pch = 20, 
              grid=F, box=F,
              axis = F, angle = 5, highlight.3d = T)

dev.off()


#Create torus, rotate it so it actually looks like a torus
torus.3d <-   torusUnif(2400, 1.8, 5)
torus.3d <- rotate(torus.3d[,1], torus.3d[,2], torus.3d[,3], 
                   degrx = 45, degry = 0, degrz = 0, 
                   pivotx = NA_real_,
                   pivoty = NA_real_, pivotz = NA_real_)

#Save Plot As Image
png(filename = "./Figures/Unrasterized_Images/torus.png",
    width = 1.36*5, height = 1*5, units = "in", res = 300)

scatterplot3d(torus.3d, pch = 20, 
              highlight.3d = T,
              grid=F, box=F,
              axis = F, angle = 0)

dev.off()

#Create 2d box, add 0 to y axis to make it look normal
box.2d <- unifbox(350, 2)
box.2d <- cbind(box.2d, 0)
box.2d <- box.2d[,c(1,3,2)]

#Save Plot As Image
png(filename = "./Figures/Unrasterized_Images/square.png",
    width = 1.36*5, height = 1*5, units = "in", res = 300)
scatterplot3d(box.2d, pch = 20, 
              highlight.3d = T,  
              grid=F, box=F,
              axis = F, angle = 0)
dev.off()


#Create 3d box
box.3d <- unifbox(4000, 3)
box.3d <- rotate(box.3d[,1], box.3d[,2], box.3d[,3], 
                 degrx = 30, degry = 60, degrz = 30, 
                 pivotx = NA_real_,
                 pivoty = NA_real_, pivotz = NA_real_)

#Save Plot As Image
png(filename = "./Figures/Unrasterized_Images/cube.png",
    width = 1.16*5, height = 1*5, units = "in", res = 300)
box.3d.plot <- scatterplot3d(box.3d, pch = 20, 
                             grid=F, box=F,
                             axis = F, angle = 5, highlight.3d = T)
dev.off()


library(magick)

####Raster the point cloud images on ggplot####
#Reading in Point Clouds and Cropping them
torus <- image_read("./Figures/Unrasterized_Images/torus.png") %>% 
  image_scale("1000") %>% 
  image_crop("525x410+225+150")

circle <- image_read("./Figures/Unrasterized_Images/circle.png") %>% 
  image_scale("1000") %>% 
  image_crop("525x450+225+125")

sphere <- image_read("./Figures/Unrasterized_Images/sphere.png") %>% 
  image_scale("1000") %>% 
  image_crop("525x525+225+150")

annulus.2 <- image_read("./Figures/Unrasterized_Images/2annulus.png") %>% 
  image_scale("1200") %>% 
  image_crop("525x450+315+240")

annulus.3 <- image_read("./Figures/Unrasterized_Images/3annulus.png") %>% 
  image_scale("1400") %>% 
  image_crop("525x525+410+320")

square <- image_read("./Figures/Unrasterized_Images/square.png") %>% 
  image_scale("900") %>% 
  image_crop("525x450+175+75")

cube <- image_read("./Figures/Unrasterized_Images/cube.png") %>% 
  image_scale("1000") %>% 
  image_crop("525x475+225+200")


#Read in Figure 1
fig1.unrast <- image_read("./Figures/Unrasterized_Images/fig1.png")
#Combine Figure and Image
fig.1.rast <- image_composite(fig1.unrast, torus, offset = "+25+125", gravity = "northeast")
#Write Out File
image_write(fig.1.rast, path = './Figures/Final_Figures/fig1.png', format = 'png')


#Read in Figure 2
fig2.unrast <- image_read("./Figures/Unrasterized_Images/fig2.png")
#Combine Figure and Image
fig2.rast1 <- circle %>% image_scale("200") %>%
  image_composite(fig2.unrast, ., offset = "+3225+205", 
                  gravity = "northeast")

fig2.rast2 <- sphere %>% image_scale("200") %>%
  image_composite(fig2.rast1, ., offset = "+1700+205", 
                  gravity = "northeast")

#Write Out File
image_write(fig2.rast2, path = './Figures/Final_Figures/fig2.png', format = 'png')

#Figure_5a
fig5a.unrast <- image_read("./Figures/Unrasterized_Images/fig5a.png")
#Combine Figure and Images
fig5a.rast1 <- annulus.3 %>% image_scale("200") %>%
  image_composite(fig5a.unrast, ., offset = "+1875+175", 
                  gravity = "northeast")

fig5a.rast2 <- sphere %>% image_scale("190") %>%
  image_composite(fig5a.rast1, ., offset = "+720+175", 
                  gravity = "northeast")

fig5a.rast3 <- torus %>% image_scale("210") %>%
  image_composite(fig5a.rast2, ., offset = "+1865+850", 
                  gravity = "northeast")

fig5a.rast4 <- cube %>% image_scale("210") %>%
  image_composite(fig5a.rast3, ., offset = "+710+850", 
                  gravity = "northeast")

#Write Out File
image_write(fig5a.rast4, path = './Figures/Final_Figures/fig5a.png', format = 'png')


#Figure_5c
fig5c.unrast <- image_read("./Figures/Unrasterized_Images/fig5c.png")
#Combine Figure and Images
fig5c.rast1 <- annulus.3 %>% image_scale("150") %>%
  image_composite(fig5c.unrast, ., offset = "+1850+280", 
                  gravity = "northeast")

fig5c.rast2 <- sphere %>% image_scale("150") %>%
  image_composite(fig5c.rast1, ., offset = "+410+550", 
                  gravity = "northeast")

fig5c.rast3 <- torus %>% image_scale("150") %>%
  image_composite(fig5c.rast2, ., offset = "+1875+1300", 
                  gravity = "northeast")

fig5c.rast4 <- cube %>% image_scale("150") %>%
  image_composite(fig5c.rast3, ., offset = "+325+1375", 
                  gravity = "northeast")

fig5c.rast5 <- annulus.2 %>% image_scale("150") %>%
  image_composite(fig5c.rast4, ., offset = "+1850+775", 
                  gravity = "northeast")

fig5c.rast6 <- circle %>% image_scale("150") %>%
  image_composite(fig5c.rast5, ., offset = "+400+830", 
                  gravity = "northeast")

fig5c.rast7 <- square %>% image_scale("150") %>%
  image_composite(fig5c.rast6, ., offset = "+325+1910", 
                  gravity = "northeast")

image_write(fig5c.rast7, path = './Figures/Final_Figures/fig5c.png', format = 'png')

#Figure 6#
fig6.unrast <- image_read("./Figures/Unrasterized_Images/fig6.png")
#Combine Figure and Images
fig6.rast1 <- annulus.3 %>% image_scale("185") %>%
  image_composite(fig6.unrast, ., offset = "+1975+225", 
                  gravity = "northeast")

fig6.rast2 <- sphere %>% image_scale("185") %>%
  image_composite(fig6.rast1, ., offset = "+820+225", 
                  gravity = "northeast")

fig6.rast3 <- torus %>% image_scale("185") %>%
  image_composite(fig6.rast2, ., offset = "+1965+900", 
                  gravity = "northeast")

fig6.rast4 <- cube %>% image_scale("185") %>%
  image_composite(fig6.rast3, ., offset = "+810+900", 
                  gravity = "northeast")
fig6.rast4

image_write(fig6.rast4, path = './Figures/Final_Figures/fig6.png', format = 'png')




#Other Figures
#These don't need rasterizing
fig3 <- image_read("./Figures/Unrasterized_Images/fig3.png") 
image_write(fig3, path = './Figures/Final_Figures/fig3.png', format = 'png')

fig4 <- image_read("./Figures/Unrasterized_Images/fig4.png") 
image_write(fig4, path = './Figures/Final_Figures/fig4.png', format = 'png')

fig5b <- image_read("./Figures/Unrasterized_Images/fig5b.png") 
image_write(fig5b, path = './Figures/Final_Figures/fig5b.png', format = 'png')

#Combine Figure 5 b and c into one grid
library(png)
library(grid)
library(gridExtra)

plot2 <- readPNG('./Figures/Final_Figures/fig5b.png')
plot3 <- readPNG('./Figures/Final_Figures/fig5c.png')

png("./Figures/Final_Figures/fig5t.png", width = 6, height = 4, 
    units = "in", res = 450)
grid.arrange(
  rasterGrob(plot2, interpolate = T), 
  rasterGrob(plot3, interpolate = T), 
  nrow=1)
dev.off()

#Cropping White Space
#Crop white space for Intro Alpha
alpha <- image_read("./Figures/Final_Figures/Intro_Alpha.png") 
alpha <- image_crop(alpha, "2700x1040", gravity = "North")
alpha <- image_crop(alpha, "2700x710", gravity = "South")
image_write(alpha, path = './Figures/Final_Figures/Intro_Alpha.png', format = 'png')

#Crop white space for Figure 5t
fig5 <- image_read("./Figures/Final_Figures/fig5t.png") 
fig5 <- image_crop(fig5, "2700x1400", gravity = "North")
fig5 <- image_crop(fig5, "2700x1020", gravity = "South")
image_write(fig5, path = './Figures/Final_Figures/fig5t.png', format = 'png')